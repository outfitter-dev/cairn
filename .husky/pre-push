#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# :A: ctx Comprehensive pre-push validation to match CI pipeline
echo "ğŸ” Running pre-push validation..."

# Run tests
echo "ğŸ“‹ Running tests..."
pnpm vitest run || {
    echo "âŒ Tests failed! Fix failing tests before pushing."
    exit 1
}

# Run typecheck
echo "ğŸ” Type checking..."
pnpm typecheck || {
    echo "âŒ Type checking failed! Fix type errors before pushing."
    exit 1
}

# Run build to ensure it compiles
echo "ğŸ”¨ Building project..."
pnpm build || {
    echo "âŒ Build failed! Fix build errors before pushing."
    exit 1
}

# Check for temporary markers that shouldn't be pushed
echo "ğŸ” Checking for temporary code markers..."
if git diff --cached --name-only | xargs grep -l ":A: tmp\|:A: temp" 2>/dev/null; then
    echo "âŒ Found temporary code markers (:A: tmp or :A: temp)!"
    echo "Remove or resolve these before pushing."
    exit 1
fi

echo "âœ… All pre-push checks passed!"